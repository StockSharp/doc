# Правило До

## Обзор

`SimpleRulesUntilStrategy` - это стратегия, демонстрирующая использование правила с условием завершения (`Until`) в StockSharp. Она подписывается на сделки и стакан, а затем устанавливает правило, которое выполняется до достижения определенного условия.

## Основные компоненты

```cs
// Основные компоненты
public class SimpleRulesUntilStrategy : Strategy
{
}
```

## Метод OnStarted

Вызывается при запуске стратегии:

- Подписывается на сделки и стакан
- Создает правило, которое выполняется при получении данных стакана до достижения определенного условия

```cs
// Метод OnStarted
protected override void OnStarted(DateTimeOffset time)
{
    var tickSub = this.SubscribeTrades(Security);

    var mdSub = this.SubscribeMarketDepth(Security);

    var i = 0;
    mdSub.WhenOrderBookReceived(this).Do(depth =>
    {
        i++;
        this.AddInfoLog($"The rule WhenOrderBookReceived BestBid={depth.GetBestBid()}, BestAsk={depth.GetBestAsk()}");
        this.AddInfoLog($"The rule WhenOrderBookReceived i={i}");
    })
    .Until(() => i >= 10)
    .Apply(this);

    base.OnStarted(time);
}
```

## Логика работы

- При запуске стратегия подписывается на сделки и стакан
- Создается правило, которое срабатывает при каждом получении данных стакана
- При срабатывании правила:
  - Увеличивается счетчик `i`
  - В лог добавляется информация о лучших ценах bid и ask
  - В лог добавляется текущее значение счетчика `i`
- Правило выполняется до тех пор, пока значение счетчика `i` не достигнет или не превысит 10

## Особенности

- Демонстрирует использование метода `Until()` для ограничения выполнения правила
- Использует подписку на сделки и стакан
- Показывает пример логирования информации о стакане и состоянии счетчика
- Иллюстрирует, как можно ограничить количество выполнений правила на основе определенного условия